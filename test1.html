<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Html5 Canvas 实现图片合成</title>

        <style>
            body{
                text-align: center;
            }
            img {
                border: solid 1px #ddd;
            }
        </style>
    </head>

    <body>
        <div align="center">
            <img src="cv.png">
            <img src="code@2x.png">
        </div>
        <input type="button" value="一键合成" onclick="hecheng()">
        <a href="" download id="downloadPic">下载合成图</a>
        <!--海报生成之后的展示-->
        <div id="imgBox" align="center">
            
        </div>
        <script>
            //当hecheng()自我执行的时（这个例子里面是点击之后再生成海报的），海报就可以生成了，之后直接点击下载即可。
            function hecheng() {
                draw(function() {
                    //下面一句话可以不要，任然可以下载图片
                    document.getElementById('imgBox').innerHTML = '<img src="' + base64[0] + '">';

                    document.getElementById('downloadPic').href = base64[0];
                })
            }

            //下面第一个路径是海报的背景，第二个路径是海报的二维码（这个路径也可以是base64代码）
            var data = ['cv.png', 'code@2x.png'],
                base64 = [],
                mychar= "哇~哇~哇~哦哇哇哇哇哇~哇~哇~哦哇哇哇哇哇~哇~哇~哦哇哇哇哇";




            function draw(fn) {
                var c = document.createElement('canvas'),
                    ctx = c.getContext('2d'),
                    len = data.length;
                //海报的宽和高
                c.width = 750;
                c.height = 1334;
                ctx.rect(0, 0, c.width, c.height);
                ctx.fillStyle = '#fff';
                ctx.fill();
                // 给canvas绘制文字
                function drawChar(char,pos){
                    ctx.textAlign='center';   // 文字居中
                    ctx.fillStyle='#ffffff';  // 文字颜色：黑色
                    ctx.font= "bold 33px Arial";        // 文字字号：22px
                    ctx.fillText(char, 375, pos)
                }
                // canvas绘制图像
                function drawing(n) {
                    if(n < len) {
                        var img = new Image;
                        img.crossOrigin = 'Anonymous'; //解决跨域

                        img.src = data[n];
                        img.onload = function() {
                            if(n == 1) {
                                ctx.drawImage(img, 261, 695, 230, 230); //121和129表示二维码距离背景图片左上角的X轴，Y轴，160表示生成的图片中二维码的大小
                            } else {
                                ctx.drawImage(img, 0, 0, c.width, c.height);
                            }

                            drawing(n + 1); //递归
                        }
                    } else {
                        // 先画图片  再画文字   文字才不会被图片挡住
                        if(mychar.length>17){
                            var char1 = mychar.slice(0,15),
                                char2 = mychar.slice(15);
                            //文字的位置
                            drawChar(char1,500);
                            drawChar(char2,540);

                        }else{
                            drawChar(mychar,540)
                        }
                        //保存生成作品图片
                        base64.push(c.toDataURL()); //通过canvas.toDataURL转成base64.
                        //alert(JSON.stringify(base64));
                        fn();
                    }
                }
                drawing(0);
            }
        </script>
    </body>

</html>